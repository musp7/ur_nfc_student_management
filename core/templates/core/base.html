{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Student Management System{% endblock %}</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Bootstrap 5 CSS -->

    <style>
        /* Student verification card styling */
.verification-card {
    border-left: 5px solid var(--ur-primary);
}

.student-photo {
    border: 3px solid #dee2e6;
    border-radius: 8px;
    transition: all 0.3s ease;
}

.student-photo:hover {
    transform: scale(1.05);
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
}

.status-badge {
    font-size: 1rem;
    padding: 0.5rem 1rem;
}
        :root {
            --ur-primary: #003366;
            --ur-secondary: #0056b3;
            --ur-accent: #e6f0ff;
        }
        
        body {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            background-color: #f8f9fa;
        }
        
        .navbar {
            background-color: var(--ur-primary);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .navbar-brand {
            font-weight: 700;
        }
        
        .ur-header {
            background: linear-gradient(135deg, var(--ur-primary), var(--ur-secondary));
            color: white;
            padding: 3rem 0;
            margin-bottom: 2rem;
        }
        
        footer {
            background-color: var(--ur-primary);
            color: white;
            padding: 1rem 0;
            margin-top: auto;
        }
        
        /* Mobile login dropdown styles */
        .mobile-login-dropdown .dropdown-item i {
            width: 1.25em;
            text-align: center;
            margin-right: 0.5rem;
            color: var(--ur-primary);
        }

        /* About Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: 15px;
            max-width: 700px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            color: #333;
        }
        
        .close-modal {
            position: absolute;
            top: 1rem;
            right: 1rem;
            font-size: 1.5rem;
            cursor: pointer;
            background: none;
            border: none;
            color: #6c757d;
        }
        
        .team-member {
            display: flex;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        
        .team-member img {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            object-fit: cover;
            margin-right: 1.5rem;
        }
        
        .about-link {
            color: white;
            text-decoration: none;
            cursor: pointer;
            transition: opacity 0.2s;
        }
        
        .about-link:hover {
            opacity: 0.8;
            text-decoration: underline;
        }

        /* Feature list styles */
        .feature-list {
            padding-left: 0;
            list-style-type: none;
        }
        
        .feature-list li {
            display: flex;
            align-items: center;
            margin-bottom: 0.75rem;
        }
        
        .feature-list i {
            margin-right: 0.75rem;
            font-size: 1.25rem;
            min-width: 1.5em;
            text-align: center;
        }
    </style>
    
    {% block extra_css %}{% endblock %}
</head>
<body>
   
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark mb-4">
        <div class="container">
            <a class="navbar-brand" href="{% url 'landing-page' %}">
                <i class="fas fa-university me-2"></i>SSMS
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    {% if user.is_authenticated %}
                        {% if user.role == 'gatekeeper' %}
                            <li class="nav-item">
                                <a class="nav-link" href="{% url 'gatekeeper-dashboard' %}">
                                    <i class="fas fa-home me-1"></i> Dashboard
                                </a>
                            </li>
                        {% elif user.role == 'teacher' %}
                            <li class="nav-item">
                                <a class="nav-link" href="{% url 'teacher-dashboard' %}">
                                    <i class="fas fa-home me-1"></i> Dashboard
                                </a>
                            </li>
                        {% elif user.role == 'registrar' %}
                            <li class="nav-item">
                                <a class="nav-link" href="{% url 'registrar-dashboard' %}">
                                    <i class="fas fa-home me-1"></i> Dashboard
                                </a>
                            </li>
                        {% elif user.role == 'finance' %}
                            <li class="nav-item">
                                <a class="nav-link" href="{% url 'finance-dashboard' %}">
                                    <i class="fas fa-home me-1"></i> Dashboard
                                </a>
                            </li>
                        {% endif %}
                    {% endif %}
                </ul>
                
                <ul class="navbar-nav">
                    {% if user.is_authenticated %}
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button" data-bs-toggle="dropdown">
                                <i class="fas fa-user-circle me-1"></i> {{ user.username }}
                            </a>
                            <ul class="dropdown-menu dropdown-menu-end">
                                <li>
                                    <form method="post" action="{% url 'logout' %}">
                                        {% csrf_token %}
                                        <button type="submit" class="dropdown-item">
                                            <i class="fas fa-sign-out-alt me-1"></i> Logout
                                        </button>
                                    </form>
                                </li>
                            </ul>
                        </li>
                    {% else %}
                        <!-- Mobile dropdown login (hidden on lg screens) -->
                        <li class="nav-item dropdown d-lg-none">
                            <a class="nav-link dropdown-toggle" href="#" id="mobileLoginDropdown" role="button" data-bs-toggle="dropdown">
                                <i class="fas fa-sign-in-alt me-1"></i> Select Portal
                            </a>
                            <ul class="dropdown-menu dropdown-menu-end mobile-login-dropdown">
                                <li><h6 class="dropdown-header">Select Portal</h6></li>
                                <li>
                                    <a class="dropdown-item" href="{% url 'login' %}?next=/gatekeeper/dashboard/&role=gatekeeper">
                                        <i class="fas fa-shield-alt me-2"></i> Gatekeeper
                                    </a>
                                </li>
                                <li>
                                    <a class="dropdown-item" href="{% url 'login' %}?next=/teacher/dashboard/&role=teacher">
                                        <i class="fas fa-chalkboard-teacher me-2"></i> Teacher
                                    </a>
                                </li>
                                <li>
                                    <a class="dropdown-item" href="{% url 'login' %}?next=/registrar/dashboard/&role=registrar">
                                        <i class="fas fa-user-edit me-2"></i> Registrar
                                    </a>
                                </li>
                                <li>
                                    <a class="dropdown-item" href="{% url 'login' %}?next=/finance/dashboard/&role=finance">
                                        <i class="fas fa-money-bill-wave me-2"></i> Finance
                                    </a>
                                </li>
                            </ul>
                        </li>
                    {% endif %}
                </ul>
            </div>
        </div>
    </nav>
    
    <!-- Main Content -->
    <main class="container mb-4">
        {% if messages %}
            {% for message in messages %}
                <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            {% endfor %}
        {% endif %}
        
        {% block content %}{% endblock %}
    </main>
    
    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <p class="mb-0 small">&copy; {% now "Y" %} SSMS</p>
                </div>
                <div class="col-md-6 text-md-end">
                    <p class="mb-0 small">
                        Smart Student Management System | 
                        <span class="about-link" id="aboutBtn">
                            <i class="fas fa-info-circle me-1"></i>About Us
                        </span>
                    </p>
                </div>
            </div>
        </div>
    </footer>

    <!-- About Us Modal -->
    <div class="modal-overlay" id="aboutModal">
        <div class="modal-content">
            <button class="close-modal" id="closeModal">&times;</button>
            <h2 class="mb-4" style="color: var(--ur-primary);">About Us</h2>
            
            <div class="mb-4">
                
                <p>The NFC Student Management System is a Django-based web application developed to optimize student administration processes through role-specific functionalities for Registrars, Gatekeepers, Teachers, and Finance Staff. By integrating Near Field Communication (NFC) technology, the system facilitates efficient attendance tracking and comprehensive student profile management.
                    This project represents the original work of a team of three undergraduate students, undertaken in partial fulfillment of the requirements for the degree of Bachelor of Science with Honors in Information Technology for the academic year 2024–2025.
                    </p>
            </div>
            
           
            
            <div class="mb-4">
                <h4 class="mb-3">Project Contributors:</h4>
                <div class="team-member">
                    <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcT_w4FVSpWbIrBsVwT4CjpITNbcqhwyL8d7Ag&s" alt="Peter TUGIRUMUREMYI">
                    <div>
                        <h5>Tugirumuremyi Peter</h5>
                        <h8>220010933</h8>
                    </div>
                </div>
                <div class="team-member">
                    <img src="https://i.ibb.co/sdBGkpnG/PASSPORT-PIC-011124.png" alt="Peter MUSIRIKARE">
                    <div>
                        <h5>Musirikare Peter	</h5>
                        <h8>221002205</h8>
                    </div>
                </div>
                <div class="team-member">
                    <img src="https://i.ibb.co/NfgZSDd/Protais-profile.jpg" alt="Protais NIRERE">
                    <div>
                        <h5>Nirere Protais	</h5>
                        <h8>221005020</h8>
                    </div>
                </div>
            </div>
            <div class="mb-4">
                <h4 class="mb-3">Institution</h4>
                <p> University of Rwanda<br>
                    Nyarugenge Campus<br>
                    College of Science and Technology (CST)<br>
                    School of Information and Communication Technology<br>
                    Department of Information technology
                    
                    </p>
                
            </div>

        
            
            <div>
                <h4 class="mb-3">Contact Us</h4>
                <p><i class="fas fa-envelope me-2"></i>tugire.peter@gmail.com || musirp3@gmail.com || nirereprotais@gmail.com </p>
                <p><i class="fas fa-phone me-2"></i> +250 782 580 213 || +250 789 915 202 || +250 788 945 559 </p>
            </div>
        </div>
    </div>
    
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    
    
    <script>
    $(document).ready(function() {
        // Campus -> College
        $('#id_campus').change(function() {
            var campusId = $(this).val();
            if (campusId) {
                $.ajax({
                    url: "{% url 'ajax_load_colleges' %}",
                    data: {
                        'campus_id': campusId
                    },
                    success: function(data) {
                        $('#id_college').html(data);
                        $('#id_school').html('<option value="">---------</option>');
                        $('#id_department').html('<option value="">---------</option>');
                        $('#id_student_class').html('<option value="">---------</option>');
                    }
                });
            } else {
                $('#id_college').html('<option value="">---------</option>');
                $('#id_school').html('<option value="">---------</option>');
                $('#id_department').html('<option value="">---------</option>');
                $('#id_student_class').html('<option value="">---------</option>');
            }
        });

        // College -> School
        $('#id_college').change(function() {
            var collegeId = $(this).val();
            if (collegeId) {
                $.ajax({
                    url: "{% url 'ajax_load_schools' %}",
                    data: {
                        'college_id': collegeId
                    },
                    success: function(data) {
                        $('#id_school').html(data);
                        $('#id_department').html('<option value="">---------</option>');
                        $('#id_student_class').html('<option value="">---------</option>');
                    }
                });
            } else {
                $('#id_school').html('<option value="">---------</option>');
                $('#id_department').html('<option value="">---------</option>');
                $('#id_student_class').html('<option value="">---------</option>');
            }
        });

        // School -> Department
        $('#id_school').change(function() {
            var schoolId = $(this).val();
            if (schoolId) {
                $.ajax({
                    url: "{% url 'ajax_load_departments' %}",
                    data: {
                        'school_id': schoolId
                    },
                    success: function(data) {
                        $('#id_department').html(data);
                        $('#id_student_class').html('<option value="">---------</option>');
                    }
                });
            } else {
                $('#id_department').html('<option value="">---------</option>');
                $('#id_student_class').html('<option value="">---------</option>');
            }
        });

        // Department -> Class
        $('#id_department').change(function() {
            var departmentId = $(this).val();
            if (departmentId) {
                $.ajax({
                    url: "{% url 'ajax_load_classes' %}",
                    data: {
                        'department_id': departmentId
                    },
                    success: function(data) {
                        $('#id_student_class').html(data);
                    }
                });
            } else {
                $('#id_student_class').html('<option value="">---------</option>');
            }
        });

        // About Modal functionality - will work on all pages
        const aboutBtn = document.getElementById('aboutBtn');
        if (aboutBtn) {
            const closeModal = document.getElementById('closeModal');
            const aboutModal = document.getElementById('aboutModal');
            
            // Show modal
            aboutBtn.addEventListener('click', function() {
                aboutModal.classList.add('active');
                document.body.style.overflow = 'hidden';
            });
            
            // Hide modal
            closeModal.addEventListener('click', function() {
                aboutModal.classList.remove('active');
                document.body.style.overflow = '';
            });
            
            // Hide modal when clicking outside content
            aboutModal.addEventListener('click', function(e) {
                if (e.target === aboutModal) {
                    aboutModal.classList.remove('active');
                    document.body.style.overflow = '';
                }
            });
            
            // Close modal with Escape key
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && aboutModal.classList.contains('active')) {
                    aboutModal.classList.remove('active');
                    document.body.style.overflow = '';
                }
            });
        }
    });
    </script>
    {% block extra_js %}
    {% endblock %}
</body>
</html>