{% extends 'core/base.html' %}

{% block title %}Login - UR NFC System{% endblock %}

{% block content %}
<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-8 col-lg-6">
            <!-- Login Card -->
            <div class="card border-0 shadow-lg" style="border-radius: 15px; overflow: hidden;">
                <div class="row g-0">
                    <!-- Left Side - Visual Branding -->
                    <div class="col-md-5 d-none d-md-block" 
                         style="background: linear-gradient(135deg, #003366, #0056b3);">
                        <div class="h-100 d-flex flex-column justify-content-center align-items-center p-4 text-white">
                            <div class="text-center mb-4">
                                <i class="fas fa-university fa-4x mb-3"></i>
                                <h4>SMS</h4>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Right Side - Login Form -->
                    <div class="col-md-7">
                        <div class="card-body p-4 p-md-5">
                            <!-- Header -->
                            <div class="text-center mb-4">
                                <h3 class="fw-bold" style="color: #003366;">Welcome Back</h3>
                                <p class="text-muted">Please login to your account</p>
                            </div>
                            
                            <!-- Error Messages -->
                            {% if messages %}
                                {% for message in messages %}
                                <div class="alert alert-{{ message.tags }} alert-dismissible fade show mb-3 py-2">
                                    {{ message }}
                                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                                </div>
                                {% endfor %}
                            {% endif %}
                            
                            <!-- Login Form -->
                            <form method="post" class="needs-validation" novalidate>
                                {% csrf_token %}
                                
                                <div class="mb-3">
                                    <label for="username" class="form-label small text-uppercase fw-bold text-muted">Username</label>
                                    <div class="input-group">
                                        <span class="input-group-text bg-light border-end-0">
                                            <i class="fas fa-user text-muted"></i>
                                        </span>
                                        <input type="text" class="form-control border-start-0 ps-2" 
                                               id="username" name="username" required
                                               placeholder="Enter your username">
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="password" class="form-label small text-uppercase fw-bold text-muted">Password</label>
                                    <div class="input-group">
                                        <span class="input-group-text bg-light border-end-0">
                                            <i class="fas fa-lock text-muted"></i>
                                        </span>
                                        <input type="password" class="form-control border-start-0 ps-2" 
                                               id="password" name="password" required
                                               placeholder="Enter your password">
                                        <button class="btn btn-outline-secondary toggle-password" type="button">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                    </div>
                                </div>
                                
                                
                                
                                <div class="d-grid mb-3">
                                    <button class="btn btn-primary py-2 fw-bold" type="submit">
                                        <i class="fas fa-sign-in-alt me-2"></i> Login
                                    </button>
                                </div>
                                
                                <div class="text-center small text-muted">
                                    <span>Don't have an account? </span>
                                    <a href="#" class="text-decoration-none contact-admin-link" style="color: #0056b3;">Contact Admin</a>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Portal Quick Links (Mobile Only) -->
            <div class="d-block d-md-none mt-4">
                <div class="text-center mb-3">
                    <p class="small text-muted">Access specific portals:</p>
                </div>
                <div class="d-flex justify-content-center gap-2">
                    <a href="?role=gatekeeper" class="btn btn-sm btn-outline-primary">Gatekeeper</a>
                    <a href="?role=teacher" class="btn btn-sm btn-outline-primary">Teacher</a>
                    <a href="?role=registrar" class="btn btn-sm btn-outline-primary">Registrar</a>
                    <a href="?role=finance" class="btn btn-sm btn-outline-primary">Finance</a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Contact Admin Modal -->
<div class="modal fade" id="contactAdminModal" tabindex="-1" aria-labelledby="contactAdminModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title" id="contactAdminModalLabel">Contact System Administrator</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="contactAdminForm">
                    <div class="mb-3">
                        <label for="contactName" class="form-label">Your Name</label>
                        <input type="text" class="form-control" id="contactName" required>
                    </div>
                    <div class="mb-3">
                        <label for="contactEmail" class="form-label">Email Address</label>
                        <input type="email" class="form-control" id="contactEmail" required>
                    </div>
                    <div class="mb-3">
                        <label for="contactSubject" class="form-label">Subject</label>
                        <select class="form-select" id="contactSubject" required>
                            <option value="" selected disabled>Select a subject</option>
                            <option value="Account Request">Account Request</option>
                            <option value="Login Issues">Login Issues</option>
                            <option value="System Problem">System Problem</option>
                            <option value="Feature Request">Feature Request</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="contactMessage" class="form-label">Message</label>
                        <textarea class="form-control" id="contactMessage" rows="4" required></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="submitContactForm">Submit</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
$(document).ready(function() {
    // Toggle password visibility
    $('.toggle-password').click(function() {
        const icon = $(this).find('i');
        const input = $(this).prev('input');
        
        if (input.attr('type') === 'password') {
            input.attr('type', 'text');
            icon.removeClass('fa-eye').addClass('fa-eye-slash');
        } else {
            input.attr('type', 'password');
            icon.removeClass('fa-eye-slash').addClass('fa-eye');
        }
    });
    
    // Form validation
    $('.needs-validation').on('submit', function(e) {
        if (!this.checkValidity()) {
            e.preventDefault();
            e.stopPropagation();
        }
        $(this).addClass('was-validated');
    });

    // Contact Admin Modal
    $('.contact-admin-link').click(function(e) {
        e.preventDefault();
        $('#contactAdminModal').modal('show');
    });

    // Submit contact form
    $('#submitContactForm').click(function() {
        const form = $('#contactAdminForm');
        if (form[0].checkValidity()) {
            // Here you would typically make an AJAX call to submit the form
            const formData = {
                name: $('#contactName').val(),
                email: $('#contactEmail').val(),
                subject: $('#contactSubject').val(),
                message: $('#contactMessage').val()
            };
            
            // Example AJAX call (you'll need to implement the backend endpoint)
            $.ajax({
                url: '/api/contact-admin/',
                method: 'POST',
                data: formData,
                success: function(response) {
                    $('#contactAdminModal').modal('hide');
                    alert('Your message has been sent successfully!');
                    form[0].reset();
                },
                error: function(xhr) {
                    alert('There was an error sending your message. Please try again.');
                }
            });
        } else {
            form.addClass('was-validated');
        }
    });
});
</script>

<script>
    // About Modal Functionality (Works on ALL pages)
    document.addEventListener('DOMContentLoaded', function() {
        const aboutBtn = document.getElementById('aboutBtn');
        const closeModal = document.getElementById('closeModal');
        const aboutModal = document.getElementById('aboutModal');
    
        if (aboutBtn && closeModal && aboutModal) {
            // Open modal
            aboutBtn.addEventListener('click', () => {
                aboutModal.classList.add('active');
                document.body.style.overflow = 'hidden'; // Prevent scrolling
            });
    
            // Close modal (X button)
            closeModal.addEventListener('click', () => {
                aboutModal.classList.remove('active');
                document.body.style.overflow = '';
            });
    
            // Close modal when clicking outside
            aboutModal.addEventListener('click', (e) => {
                if (e.target === aboutModal) {
                    aboutModal.classList.remove('active');
                    document.body.style.overflow = '';
                }
            });
    
            // Close modal with Escape key
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && aboutModal.classList.contains('active')) {
                    aboutModal.classList.remove('active');
                    document.body.style.overflow = '';
                }
            });
        }
    });
</script>
{% endblock %}